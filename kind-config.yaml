# kind-config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: ghostkube

nodes:
  - role: control-plane
    # Expose ports from the container to the host
    extraPortMappings:
      # Brain API (FastAPI on port 8000)
      - containerPort: 8000
        hostPort: 8000
        protocol: TCP
      # Webhook HTTPS (port 443)
      - containerPort: 443
        hostPort: 443
        protocol: TCP
      # Nginx Ingress (if you add it later)
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      - containerPort: 8080
        hostPort: 8080
        protocol: TCP
    
    # Mount local directories into the container (optional)
    extraMounts:
      # Mount your local code/data into the cluster for development
      - hostPath: ./chroma_db
        containerPath: /chroma_db
        readOnly: false
      - hostPath: ./config
        containerPath: /config
        readOnly: true

# Disable default CNI and use kindnet (default is fine)
networking:
  disableDefaultCNI: false
  apiServerAddress: "127.0.0.1"
  apiServerPort: 6443

# Set kubelet and API server config
kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        system-reserved: memory=1Gi,cpu=100m
  - |
    kind: KubeletConfiguration
    maxPods: 250